webpackJsonp([10],{"+FSY":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("3cXf"),a=i.n(s),o={name:"Cart",components:{Flyball:i("vYnV").a},data:function(){return{cartList:[],selectedList:[],isSelectAll:!1,giftInfo:null,giftList:[],recommendCommodityList:[]}},computed:{countPrice:function(){var t=0;return this.selectedList.forEach(function(e){t+=e.num*e.unitPrice}),t},countGiftPrice:function(){var t=0;return this.giftList.forEach(function(e){t+=e.num*e.unitPrice}),t}},watch:{cartList:{handler:function(t,e){this.selectedList=this.cartList.filter(function(t){if(t.commodityStock>0&&3===t.commodityStatus)return t.checked});var i=this.cartList.filter(function(t){return t.commodityStock>0&&3===t.commodityStatus})||[];this.isSelectAll=i.every(function(t){return t.checked})},deep:!0},selectedList:function(){var t=this;if(0===this.selectedList.length)return this.giftInfo=null,void(this.giftList=[]);var e={commodityCodeList:this.selectedList,siteNo:null};this.axios.post(this.api.getActivityResult,e).then(function(e){200===e.status&&200===e.data.code&&(e.data.result.freePrice=0,e.data.result.commodityInfoList&&e.data.result.commodityInfoList.forEach(function(t){e.data.result.freePrice+=t.unitPrice*t.num}),t.giftInfo=e.data.result,t.giftList=e.data.result.commodityInfoList||[])})}},created:function(){this.getCartList(),this.getRecommendCommodityList()},methods:{getRecommendCommodityList:function(){var t=this;this.axios.get(this.api.getRecommendCommodityList).then(function(e){200===e.status&&200===e.data.code&&(t.recommendCommodityList=e.data.result)})},getProductDetail:function(t){this.$router.push({name:"Detail",params:{commodityCode:t.commodityCode}})},getCartList:function(){var t=this;this.axios.post(this.api.getCartList,{}).then(function(e){200===e.status&&200===e.data.code&&(e.data.result.forEach(function(t){t.checked=!1,t.commodityStock=Math.floor(t.commodityStock)}),t.cartList=e.data.result)})},addCart:function(t,e){var i=this,s={commodityCode:e.commodityCode,num:1,secKill:!1};this.axios.post(this.api.save,s).then(function(e){200===e.status&&200===e.data.code?(i.$refs.flyball.drop(t),setTimeout(function(){i.$store.dispatch("getCartNum")},600),i.getCartList()):i.$message({message:e.data.remark,type:"warning"})})},selectAll:function(t){this.cartList.forEach(function(e){if(3===e.commodityStatus&&e.commodityStock>0)return e.checked=t})},setProductNum:function(t){var e=this,i=t.num=parseInt(t.num.replace(/\D/g,""))||1;this.setNotify(t.num,t),i>200&&t.commodityStock>200?t.num=200:i>200&&t.commodityStock<=200?t.num=t.commodityStock||1:i>t.commodityStock&&(t.num=t.commodityStock||1);var s={id:t.id,num:t.num};this.axios.post(this.api.update,s).then(function(t){200===t.status&&200===t.data.code?e.$store.dispatch("getCartNum"):e.$message({message:t.data.remark,type:"warning"})})},setNotify:function(t,e){return t>=e.commodityStock&&e.commodityStock<=200?this.$message({message:"此商品最大库存为"+e.commodityStock+"件",type:"warning"}):t>200?this.$message({message:"最多加入购物车200件",type:"warning"}):void 0},notice:function(t){var e=this;if(t.commodityStock<t.num){var i={id:t.id,num:t.commodityStock};this.axios.post(this.api.update,i).then(function(i){200===i.status&&200===i.data.code?(t.num=t.commodityStock,e.$store.dispatch("getCartNum")):e.$message({message:i.data.remark,type:"warning"})})}t.commodityStock<=200?this.$message({message:"此商品最大库存为"+t.commodityStock+"件",type:"warning"}):this.$message({message:"最多加入购物车200件",type:"warning"})},add:function(t){var e=this;this.setNotify(t.num+1,t);var i={id:t.id,num:t.num+1};this.axios.post(this.api.update,i).then(function(i){200===i.status&&200===i.data.code?(t.num++,e.$store.dispatch("getCartNum")):e.$message({message:i.data.remark,type:"warning"})})},reduce:function(t){var e=this,i={id:t.id,num:t.num-1};this.axios.post(this.api.update,i).then(function(i){200===i.status&&200===i.data.code?(t.num--,e.$store.dispatch("getCartNum")):e.$message({message:i.data.remark,type:"warning"})})},remove:function(t){var e=this;this.$confirm("是否删除该商品？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i={ids:[t.id]};e.axios.post(e.api.remove,i).then(function(i){if(200===i.status&&i.data.code<300){var s=e.cartList.indexOf(t);e.cartList.splice(s,1),e.$store.dispatch("getCartNum")}else e.$message({message:i.data.remark,type:"warning"})})})},removeSelected:function(){var t=this;0===this.selectedList.length?this.$message({message:"请选择要删除的商品",type:"warning"}):this.$confirm("是否删除选中商品？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=[];t.selectedList.forEach(function(t){e.push(t.id)});var i={ids:e};t.axios.post(t.api.remove,i).then(function(e){200===e.status&&e.data.code<300?t.selectedList.forEach(function(e){var i=t.cartList.indexOf(e);t.cartList.splice(i,1),t.$store.dispatch("getCartNum")}):t.$message({message:e.data.remark,type:"warning"})})})},removeUndercarriage:function(){var t=this,e=this.cartList.filter(function(t){return 4===t.commodityStatus});if(0===e.length)return this.$message({message:"没有已下架商品",type:"warning"});this.$confirm("是否删除已下架商品？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i={ids:[]};e.forEach(function(t){return i.ids.push(t.id)}),t.axios.post(t.api.remove,i).then(function(i){200===i.status&&i.data.code<300?e.forEach(function(e){var i=t.cartList.indexOf(e);t.cartList.splice(i,1),t.$store.dispatch("getCartNum")}):t.$message({message:i.data.remark,type:"warning"})})})},toPay:function(){0===this.selectedList.length?this.$message({message:"未选择商品",type:"warning"}):(sessionStorage.setItem("toPayCommodityList",a()(this.selectedList)),this.$router.push({name:"prePay"}))}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"cart"}},[i("h1",[t._v("购物车")]),t._v(" "),t.cartList.length>0?i("ul",{staticClass:"cart-list"},[i("li",{staticClass:"commodity-title"},[i("span",{staticClass:"select"},[i("el-checkbox",{attrs:{label:t.cartList},on:{change:t.selectAll},model:{value:t.isSelectAll,callback:function(e){t.isSelectAll=e},expression:"isSelectAll"}},[t._v(" ")]),t._v("  全选\n      ")],1),t._v(" "),i("span",{staticClass:"commodity-image"}),t._v(" "),i("span",{staticClass:"commodity-name"},[t._v("商品信息")]),t._v(" "),i("span",{staticClass:"commodity-price"},[t._v("单价")]),t._v(" "),i("span",{staticClass:"commodity-num"},[t._v("数量")]),t._v(" "),i("span",{staticClass:"total-price"},[t._v("金额")]),t._v(" "),i("span",{staticClass:"operation"},[t._v("操作")])]),t._v(" "),t._l(t.cartList,function(e,s){return i("li",{key:s,staticClass:"commodity-wrapper"},[i("span",{staticClass:"select"},[i("el-checkbox",{attrs:{label:e,disabled:!(3===e.commodityStatus&&e.commodityStock>0)},model:{value:e.checked,callback:function(i){t.$set(e,"checked",i)},expression:"item.checked"}},[t._v("\n           \n        ")])],1),t._v(" "),i("img",{attrs:{src:e.commodityPicture+t.imageSmallWidth},on:{click:function(i){t.$router.push({name:"Detail",params:{commodityCode:e.commodityCode}})}}}),t._v(" "),i("span",{staticClass:"commodity-name",on:{click:function(i){t.$router.push({name:"Detail",params:{commodityCode:e.commodityCode}})}}},[e.presell?i("span",[t._v("【预售】")]):t._e(),t._v("\n        "+t._s(e.commodityName)+"\n      ")]),t._v(" "),i("span",{staticClass:"commodity-price"},[t._v("¥ "+t._s(e.unitPrice.toFixed(2)))]),t._v(" "),3===e.commodityStatus&&e.commodityStock>0?i("span",{staticClass:"commodity-num"},[i("span",{staticClass:"label"},[t._v("数量：")]),t._v(" "),e.num>1&&e.num<=e.commodityStock?i("button",{staticClass:"reduce-button",on:{click:function(i){t.reduce(e)}}},[t._v("-")]):1===e.num?i("button",{staticClass:"reduce-button disabled"},[t._v("-")]):i("button",{staticClass:"reduce-button",on:{click:function(i){t.notice(e)}}},[t._v("-")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.trim.lazy",value:e.num,expression:"item.num",modifiers:{trim:!0,lazy:!0}}],staticClass:"number",attrs:{type:"text"},domProps:{value:e.num},on:{change:[function(i){t.$set(e,"num",i.target.value.trim())},function(i){t.setProductNum(e)}],blur:function(e){t.$forceUpdate()}}}),t._v(" "),e.num<200&&e.num<e.commodityStock?i("button",{staticClass:"add-button",on:{click:function(i){t.add(e)}}},[t._v("+")]):i("button",{staticClass:"add-button",on:{click:function(i){t.notice(e)}}},[t._v("+")])]):i("span",{staticStyle:{display:"inline-block",width:"200px"}},[3!==e.commodityStatus?i("span",[t._v("\n          已下架\n          "),i("span",{staticStyle:{"text-decoration":"line-through"}},[t._v("加入购物车"+t._s(e.num)+"件")])]):0===e.commodityStock?i("span",[t._v("\n          已售罄\n          "),i("span",{staticStyle:{"text-decoration":"line-through"}},[t._v("加入购物车"+t._s(e.num)+"件")])]):t._e()]),t._v(" "),i("span",{staticClass:"total-price"},[t._v("¥ "+t._s((e.unitPrice*e.num).toFixed(2)))]),t._v(" "),i("span",{staticClass:"operation",on:{click:function(i){t.remove(e)}}},[t._v("删除")])])}),t._v(" "),t.giftInfo?t._l(t.giftList,function(e,s){return i("li",{key:e.commodityCode,staticClass:"commodity-wrapper"},[i("span",{staticClass:"select"},[i("el-checkbox",{attrs:{checked:!0,label:e,disabled:""}},[t._v("\n             \n          ")])],1),t._v(" "),i("img",{attrs:{src:e.commodityPicture},on:{click:function(i){t.$router.push({name:"Detail",params:{commodityCode:e.commodityCode}})}}}),t._v(" "),i("span",{staticClass:"commodity-name",on:{click:function(i){t.$router.push({name:"Detail",params:{commodityCode:e.commodityCode}})}}},[i("span",[t._v("【赠品】")]),t._v("\n          "+t._s(e.commodityName)+"\n        ")]),t._v(" "),i("span",{staticClass:"commodity-price"},[t._v("¥ "+t._s(e.unitPrice.toFixed(2)))]),t._v(" "),i("span",{staticClass:"commodity-num",staticStyle:{display:"inline-block",width:"200px","font-size":"14px"}},[t._v("\n          共 "+t._s(e.num)+" 件\n        ")]),t._v(" "),i("span",{staticClass:"total-price"},[t._v("¥ "+t._s((e.unitPrice*e.num).toFixed(2)))])])}):t._e(),t._v(" "),i("li",{staticClass:"commodity-footer"},[i("div",{staticClass:"cart-opetation"},[i("span",{staticClass:"select"},[i("el-checkbox",{attrs:{label:t.cartList},on:{change:t.selectAll},model:{value:t.isSelectAll,callback:function(e){t.isSelectAll=e},expression:"isSelectAll"}},[t._v(" ")]),t._v("  全选\n        ")],1),t._v(" "),i("span",{staticClass:"remove-selected",on:{click:t.removeSelected}},[t._v("删除选择商品")]),t._v(" "),i("span",{staticClass:"remove-undercarriage"},[i("span",{on:{click:t.removeUndercarriage}},[t._v("清除下架商品")])])]),t._v(" "),i("span",{staticClass:"total-price"},[i("span",[t._v("\n          已选\n          "),i("span",{staticClass:"count-number"},[t._v(t._s(t.selectedList.length))]),t._v("\n          种商品\n        ")]),t._v(" "),t.giftInfo?i("span",[t._v("\n          满减：\n          "),i("span",[t._v("¥ "+t._s((t.giftInfo?t.giftInfo.fulCutFee:0).toFixed(2)))])]):t._e(),t._v(" "),t.giftInfo?i("span",[t._v("\n          买赠优惠：\n          "),i("span",[t._v("¥ "+t._s(t.countGiftPrice.toFixed(2)))])]):t._e(),t._v(" "),i("span",[t._v("\n          订单总金额：\n          "),i("span",{staticClass:"count-price"},[t._v("¥ "+t._s(t.countPrice.toFixed(2)))])]),t._v(" "),t.giftInfo?i("span",[t._v("\n          实付金额：\n          "),i("span",{staticClass:"actual-price"},[t._v("¥ "+t._s((t.countPrice-(t.giftInfo?t.giftInfo.fulCutFee:0)).toFixed(2)))])]):t._e(),t._v(" "),i("span",[i("button",{staticClass:"submit-button",on:{click:t.toPay}},[t._v("去结算")])])])])],2):i("div",{staticClass:"empty-cart",on:{click:function(e){t.$router.push({name:"Index"})}}},[i("i",{staticClass:"iconfont icon-gouwuche"}),t._v(" "),i("span",[t._v("购物车空空的，去首页逛逛吧 >>")])]),t._v(" "),i("h1",{staticClass:"recommend-header"},[t._v("推荐商品")]),t._v(" "),t.recommendCommodityList.length>0?i("div",{staticClass:"recommend-wrapper"},t._l(t.recommendCommodityList,function(e,s){return s<5?i("div",{key:s,staticClass:"recommend-commodity",staticStyle:{position:"relative"},on:{click:function(i){t.getProductDetail(e)}}},[e.presell?[i("i",{staticClass:"iconfont icon-yushou"}),t._v(" "),i("div",{staticClass:"trangle"})]:t._e(),t._v(" "),i("img",{attrs:{src:e.imageUrl}}),t._v(" "),i("div",{staticClass:"commodity-name"},[t._v(t._s(e.commodityName))]),t._v(" "),i("div",{staticClass:"commodity-price"},[t._v("¥ "+t._s(e.commoditySalesPrice.toFixed(2)))]),t._v(" "),i("div",{staticClass:"add-cart",on:{click:function(i){i.stopPropagation(),t.addCart(i,e)}}},[t._v("加入购物车")])],2):t._e()})):t._e(),t._v(" "),i("Flyball",{ref:"flyball"})],1)},staticRenderFns:[]};var c=i("Z0/y")(o,n,!1,function(t){i("ai+w")},null,null);e.default=c.exports},"ai+w":function(t,e){}});
//# sourceMappingURL=10.9f48d60a6cae6781e67c.js.map