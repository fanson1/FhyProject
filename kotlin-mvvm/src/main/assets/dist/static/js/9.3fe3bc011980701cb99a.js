webpackJsonp([9],{"0/mr":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("rVsN"),i=a.n(s),r={name:"Pay",components:{noFile:a("C80W").a},data:function(){return{orderNum:this.$route.params.orderNum,payType:1*this.$route.params.payType,lastPayPrice:sessionStorage.getItem("lastPayPrice"),dialogVisible:!1,dialogVisibleMessage:!1,willPay:!1,orderStatus:-1,timer:""}},computed:{},created:function(){var e=this;clearInterval(this.timer),this.getPayStatus(120),vm.$on("stopPolling",function(t){clearInterval(e.timer)})},watch:{$route:function(e){this.payType=Number(e.params.payType),this.willPay=!1,this.getPayStatus(120)},willPay:function(e){!0===e&&this.payDo()},"$store.state.pollingStatus":function(e){this.stopPolling()}},methods:{handleClose:function(){this.$router.replace("/User?nav=order&subNav=all")},stopPolling:function(){clearInterval(this.timer)},createQrcode:function(e){document.getElementById("qrcode").innerHTML="",new QRCode(document.getElementById("qrcode"),{width:300,height:300}).makeCode(e)},payDo:function(){var e=this,t={orderNo:this.orderNum};switch(this.payType){case 0:this.axios.post(this.api.wxPay,t).then(function(t){200===t.status&&200===t.data.code?(e.qrCode=t.data.result.payData.qr_code,e.createQrcode(e.qrCode)):e.$message.error(t.data.remark)});break;case 1:this.axios.post(this.api.aliPay,t).then(function(t){200===t.status&&200===t.data.code?(e.qrCode=t.data.result.payData.qr_code,e.createQrcode(e.qrCode)):e.$message.error(t.data.remark)})}},getOrderStatus:function(e){var t=this;this.axios.get(this.api.getOrderStatus+"?orderNo="+this.orderNum).then(function(a){if(200===a.status&&200===a.data.code)switch(t.orderStatus=a.data.result,e&&e(a.data.result),1*a.data.result){case 0:setTimeout(function(){t.$router.replace({name:"Index"})},3e3);break;case 1:t.willPay=!0;break;case 3:t.dialogVisible=!0}})},getPayStatus:function(e){var t=this;new i.a(function(e,a){t.getOrderStatus(e)}).then(function(a){if(1!==a)return!1;var s=0;t.timer=setInterval(function(){s+=5,1==t.dialogVisible?clearInterval(t.timer):s>e&&(clearInterval(t.timer),t.dialogVisibleMessage=!0),t.getOrderStatus()},5e3)})}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("article",{staticClass:"user-article p20"},[a("h2",{staticClass:"f18 no-b lh240"},[e._v("支付页面")]),e._v(" "),a("div",{staticClass:"order-box"},[e.orderStatus>0?a("div",[a("div",{staticClass:"note-info"},[e._v("\n        应付金额："),a("span",{staticClass:"order-sum"},[e._v("¥ "+e._s(e.lastPayPrice)+" ")]),e._v("\n        请您及时付款，以便订单尽快处理！订单号："+e._s(e.orderNum)+"\n      ")]),e._v(" "),1===e.orderStatus?a("div",{staticClass:"text-center",staticStyle:{padding:"50px"}},[a("p",[e._v("请使用"+e._s(0==e.payType?"微信":"支付宝")+"“扫一扫”二维码付款")]),e._v(" "),a("div",{staticStyle:{margin:"0 auto",width:"300px",padding:"10px"},attrs:{id:"qrcode"}}),e._v(" "),a("div",{staticClass:"f18 c-green"},[e._v(e._s(0==e.payType?"微信支付":"支付宝支付"))])]):e._e()]):e._e(),e._v(" "),0==e.orderStatus?a("div",[a("p",{staticClass:"p10 f14 c-red"},[e._v("订单已取消, 3秒后跳转到首页!")])]):e._e(),e._v(" "),a("div",{staticClass:"pay-box"},[a("p",[e._v("其他支付方式")]),e._v(" "),1===e.payType?a("i",{staticClass:"cursor  inline-block m10",on:{click:function(t){e.$router.replace("/pay/"+e.orderNum+"/0")}}},[e._v("微信支付")]):e._e(),e._v(" "),0===e.payType?a("i",{staticClass:"cursor  inline-block m10",on:{click:function(t){e.$router.replace("/pay/"+e.orderNum+"/1")}}},[e._v("支付宝支付")]):e._e()])]),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible,width:"20%",title:"恭喜","close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("p",{staticClass:"text-center lh220"},[a("span",{staticClass:"c-green f20 text-center b block"},[e._v("支付成功! ")]),e._v(" "),a("i",{staticClass:"f14 cursor ",on:{click:function(t){e.$router.replace("/User?nav=order&subNav=all")}}},[e._v("去订单中心查看>")]),e._v(" "),a("i",{staticClass:"f14 cursor ml20",on:{click:function(t){e.$router.replace({name:"Index"})}}},[e._v("继续购物>")])])]),e._v(" "),a("el-dialog",{attrs:{title:"消息提示",visible:e.dialogVisibleMessage,width:"20%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisibleMessage=t}}},[a("span",{staticClass:"c-666 f18"},[e._v("你可以刷新页面,查看支付结果! ")])])],1)},staticRenderFns:[]};var n=a("Z0/y")(r,o,!1,function(e){a("l6gy")},null,null);t.default=n.exports},l6gy:function(e,t){}});
//# sourceMappingURL=9.3fe3bc011980701cb99a.js.map