webpackJsonp([1],{"+c0R":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("3cXf"),i=s.n(a),n={data:function(){return{hasPic:!1,maskCxt:null,bottomCtx:null,imgWidth:0,imgHeight:0,limitLength:0,dashedDefaultLength:200,isClick:!1,isScale:!1,isFirst:!1,targetId:"",mouseX:0,mouseY:0,offsetBoxX:0,offsetBoxY:0,scaleX:0,scaleY:0,leftMaskX:0,topMaskY:0,moveOffsetX:0,moveOffsetY:0,target:0,targetWidth:0,targetHeight:0,targetLeft:0,targetTop:0,moveTop:0,resultCode1:null,resultCode2:null,resultCode3:null,type:null,imageBase64:null}},props:{value:{type:String},canvasShowLength:{default:400},saveCanvas1Length:{default:56},saveCanvas2Length:{default:120},saveCanvas3Length:{default:180},limitFileSize:{default:1}},methods:{uploadImg:function(t){var e=this;if(t&&t.target&&t.target.files[0]){var s=t.target.files[0];if(this.type=s.type,s.size/1024>1e3*this.limitFileSize)this.$message({message:"请选择小于"+this.limitFileSize+"MB的图片",type:"warning"});else if(0!==s.length){var a=new FileReader;a.readAsDataURL(s),a.onload=function(t){var s=t.target.result;e.canvasShow(s)}}else this.$message({message:"请选择图片",type:"warning"})}},canvasShow:function(t){var e=this,s=new Image;this.bottomCtx=document.getElementById("bottomCanvas").getContext("2d"),this.bottomCtx.clearRect(0,0,this.canvasShowLength,this.canvasShowLength),s.src=t,s.onload=function(){e.hasPic=!0,e.imgWidth=s.width,e.imgHeight=s.height;var t=null,a=null;if(e.imgWidth-e.imgHeight>0){t=e.imgWidth/e.canvasShowLength,a=e.imgHeight/t,e.limitLength=a;var i=(e.canvasShowLength-a)/2;a<e.dashedDefaultLength&&(e.dashedDefaultLength=a);var n=e.canvasShowLength/2-e.dashedDefaultLength/2;$(e.$refs.selectedBox).width(e.dashedDefaultLength),$(e.$refs.selectedBox).height(e.dashedDefaultLength),$(e.$refs.selectedBox).css("left",n),$(e.$refs.selectedBox).css("top",i),e.bottomCtx.drawImage(s,0,i,e.canvasShowLength,a),e.drawMask(n,i)}else{t=e.imgHeight/e.canvasShowLength,a=e.imgWidth/t,e.limitLength=a;var r=(e.canvasShowLength-a)/2;a<e.dashedDefaultLength&&(e.dashedDefaultLength=a);var o=e.canvasShowLength/2-e.dashedDefaultLength/2;$(e.$refs.selectedBox).width(e.dashedDefaultLength),$(e.$refs.selectedBox).height(e.dashedDefaultLength),$(e.$refs.selectedBox).css("left",r),$(e.$refs.selectedBox).css("top",o),e.bottomCtx.drawImage(s,r,0,a,e.canvasShowLength),e.drawMask(r,o)}$(e.$refs.cursorMove).css({height:e.dashedDefaultLength-8,width:e.dashedDefaultLength-8})}},drawMask:function(t,e){if(this.maskCxt.beginPath(),this.maskCxt.clearRect(0,0,this.canvasShowLength,this.canvasShowLength),this.maskCxt.fillStyle="rgba(0,0,0,0.4)",this.maskCxt.fillRect(0,0,this.canvasShowLength,this.canvasShowLength),this.isScale){var s=$(this.$refs.selectedBox).width(),a=$(this.$refs.selectedBox).height();switch(Math.abs(this.scaleY)<Math.abs(this.scaleX)&&(this.scaleY=this.scaleX),this.targetId){case"num1":this.maskCxt.clearRect(this.targetLeft+this.scaleY,this.targetTop+this.scaleY,s,a);break;case"num2":this.maskCxt.clearRect(this.targetLeft,this.targetTop-this.scaleX,s,a);break;case"num3":this.maskCxt.clearRect(this.targetLeft+this.scaleX,this.targetTop,s,a);break;case"num4":this.maskCxt.clearRect(this.targetLeft+this.scaleX-this.scaleX,this.targetTop,s,a)}this.maskCxt.closePath()}else{if(this.isClick){var i=$(this.$refs.selectedBox).width(),n=$(this.$refs.selectedBox).height();return this.maskCxt.clearRect(this.leftMaskX,this.topMaskY,i,n),void this.maskCxt.closePath()}var r=$(this.$refs.selectedBox).width(),o=$(this.$refs.selectedBox).height();this.maskCxt.clearRect(t,e,r,o),this.maskCxt.closePath()}},clickMask:function(t){if($(t.target).hasClass("cursor-move"))return this.isClick=!0,this.offsetBoxX=t.offsetX,void(this.offsetBoxY=t.offsetY);$(t.target).hasClass("scale-mask")&&(this.isScale=!0,this.targetId=$(t.target).attr("id"),this.mouseX=t.x,this.mouseY=t.y)},moveMask:function(t){if(this.isClick){var e=parseFloat(this.$refs.selectedBox.style.left),s=parseFloat(this.$refs.selectedBox.style.top),a=$(this.$refs.selectedBox).width(),i=$(this.$refs.selectedBox).height();this.moveOffsetX=t.offsetX-this.offsetBoxX,this.moveOffsetY=t.offsetY-this.offsetBoxY,this.leftMaskX=e+this.moveOffsetX,this.topMaskY=s+this.moveOffsetY,this.leftMaskX<=0?this.leftMaskX=0:this.leftMaskX>=this.canvasShowLength-a&&(this.leftMaskX=this.canvasShowLength-a),this.topMaskY<=0?this.topMaskY=0:this.topMaskY>=this.canvasShowLength-i&&(this.topMaskY=this.canvasShowLength-i),this.$refs.selectedBox.style.left=this.leftMaskX+"px",this.$refs.selectedBox.style.top=this.topMaskY+"px",this.drawMask()}this.isScale&&(this.scaleX=t.x-this.mouseX,this.scaleY=t.y-this.mouseY,this.drawMask(),this.scaleMaskBox())},scaleMaskBox:function(){switch(this.isFirst||(this.target=$(this.$refs.selectedBox),this.targetLeft=parseFloat(this.$refs.selectedBox.style.left),this.targetTop=parseFloat(this.$refs.selectedBox.style.top),this.targetWidth=this.target.width(),this.targetHeight=this.target.height(),this.isFirst=!0,this.moveTop=$(this.$refs.cursorMove).width()),Math.abs(this.scaleY)<Math.abs(this.scaleX)&&(this.scaleY=this.scaleX),this.targetId){case"num1":this.target.css({height:this.targetHeight-this.scaleY,width:this.targetWidth-this.scaleY,left:this.targetLeft+this.scaleY,top:this.targetTop+this.scaleY}),$(this.$refs.cursorMove).css({height:this.moveTop-this.scaleY,width:this.moveTop-this.scaleY});break;case"num2":this.target.css({height:this.targetHeight+this.scaleX,width:this.targetWidth+this.scaleX,top:this.targetTop-this.scaleX}),$(this.$refs.cursorMove).css({height:this.moveTop+this.scaleX,width:this.moveTop+this.scaleX});break;case"num3":this.target.css({height:this.targetHeight-this.scaleX,width:this.targetWidth-this.scaleX,left:this.targetLeft+this.scaleX}),$(this.$refs.cursorMove).css({height:this.moveTop-this.scaleX,width:this.moveTop-this.scaleX});break;case"num4":this.target.css({height:this.targetHeight+this.scaleY,width:this.targetWidth+this.scaleY}),$(this.$refs.cursorMove).css({height:this.moveTop+this.scaleY,width:this.moveTop+this.scaleY})}},leaveBox:function(t){this.isClick=!1,this.isScale=!1,this.scaleX=0,this.scaleY=0,this.isFirst=!1},saveAvatar:function(){var t=this;if(this.hasPic){var e=this.$refs.selectedBox.offsetLeft,s=this.$refs.selectedBox.offsetTop,a=this.$refs.selectedBox.offsetWidth,i=this.$refs.selectedBox.offsetHeight,n=this.bottomCtx.getImageData(e,s,a,i),r=document.createElement("canvas"),o=r.getContext("2d"),c=new Image;r.width=a,r.height=i,o.putImageData(n,0,0,0,0,r.width,r.height);var l=r.toDataURL("image/jpeg",.8),d=saveCanvas1.getContext("2d"),u=saveCanvas2.getContext("2d"),h=saveCanvas3.getContext("2d");d.clearRect(0,0,saveCanvas1.width,saveCanvas1.height),u.clearRect(0,0,saveCanvas2.width,saveCanvas2.height),h.clearRect(0,0,saveCanvas3.width,saveCanvas3.height),c.src=l,c.onload=function(){d.drawImage(c,0,0,saveCanvas1.width,saveCanvas1.height),u.drawImage(c,0,0,saveCanvas2.width,saveCanvas2.height),h.drawImage(c,0,0,saveCanvas3.width,saveCanvas3.height);var e=saveCanvas1.toDataURL("image/jpeg",.8),s=saveCanvas2.toDataURL("image/jpeg",.8),a=saveCanvas3.toDataURL("image/jpeg",.8),i=e.indexOf("base64,")+7,n=s.indexOf("base64,")+7,r=a.indexOf("base64,")+7;t.imageBase64=s,t.resultCode1=e.slice(i),t.resultCode2=s.slice(n),t.resultCode3=a.slice(r),t.$emit("input",t.resultCode1),t.$emit("input",t.resultCode2),t.$emit("input",t.resultCode3)}}else this.$message({message:"请选择图片",type:"warning"})},confirm:function(){var t=this;this.saveAvatar(),setTimeout(function(){if(t.resultCode2){var e={imageBase64:t.imageBase64,imageType:t.type};t.$store.dispatch("setAvatar",e)}},500)}},mounted:function(){var t=this;$(this.$refs.choosePic).hover(function(){$(t.$refs.choosePic).addClass("hover")},function(){$(t.$refs.choosePic).removeClass("hover")}).click(function(){$(t.$refs.choosePic).addClass("active"),setTimeout(function(){$(t.$refs.choosePic).removeClass("active")},100)}),$(".canvas-combination").width(this.canvasShowLength+30),$(".canvas-combination").height(this.canvasShowLength+2),this.dashedDefaultLength=this.canvasShowLength/2,this.maskCxt=document.getElementById("maskCanvas").getContext("2d"),this.leftMaskX=parseFloat(this.$refs.selectedBox.style.left),this.topMaskY=parseFloat(this.$refs.selectedBox.style.top)}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"avatarUpload"}},[s("div",{ref:"canvasArea",staticClass:"canvas-area",on:{mousedown:function(e){t.clickMask(e)},mousemove:function(e){t.moveMask(e)},mouseup:function(e){t.leaveBox(e)}}},[s("div",{staticClass:"canvas-combination"},[s("canvas",{staticStyle:{border:"1px solid #c3c3c3","box-sizing":"border-box"},attrs:{id:"bottomCanvas",width:this.canvasShowLength,height:this.canvasShowLength}}),t._v(" "),s("canvas",{class:{bg:!t.hasPic},staticStyle:{border:"1px solid #c3c3c3","box-sizing":"border-box"},attrs:{id:"maskCanvas",width:this.canvasShowLength,height:this.canvasShowLength}})]),t._v(" "),s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:t.hasPic,expression:"hasPic"}],ref:"selectedBox",staticClass:"selected-box"},[s("div",{ref:"cursorMove",staticClass:"cursor-move"}),t._v(" "),s("span",{staticClass:"scale-mask",attrs:{id:"topBorder"}}),t._v(" "),s("span",{staticClass:"scale-mask",attrs:{id:"leftBorder"}}),t._v(" "),s("span",{staticClass:"scale-mask",attrs:{id:"rightBorder"}}),t._v(" "),s("span",{staticClass:"scale-mask",attrs:{id:"bottomBorder"}}),t._v(" "),s("i",{staticClass:"scale-mask",attrs:{id:"num1"}}),t._v(" "),s("i",{staticClass:"scale-mask",attrs:{id:"num2"}}),t._v(" "),s("i",{staticClass:"scale-mask",attrs:{id:"num3"}}),t._v(" "),s("i",{staticClass:"scale-mask",attrs:{id:"num4"}})]),t._v(" "),s("div",{staticClass:"canvas-wrapper"},[s("canvas",{staticStyle:{border:"1px solid #c3c3c3","box-sizing":"border-box"},attrs:{id:"saveCanvas3",width:this.saveCanvas3Length,height:this.saveCanvas3Length}}),t._v(" "),s("canvas",{staticStyle:{border:"1px solid #c3c3c3","box-sizing":"border-box"},attrs:{id:"saveCanvas2",width:this.saveCanvas2Length,height:this.saveCanvas2Length}}),t._v(" "),s("canvas",{staticStyle:{border:"1px solid #c3c3c3","box-sizing":"border-box"},attrs:{id:"saveCanvas1",width:this.saveCanvas1Length,height:this.saveCanvas1Length}})])])]),t._v(" "),s("div",{staticClass:"button-box"},[s("input",{ref:"choosePic",staticClass:"choose-pic",staticStyle:{cursor:"pointer"},attrs:{type:"file",accept:"image/jpeg, image/jpg, image/png"},on:{change:function(e){t.uploadImg(e)}}}),t._v(" "),s("a",{staticClass:"choose-btn",attrs:{href:"javascript:;"}},[t._v("选择图片")]),t._v(" "),s("a",{staticClass:"clip-btn",attrs:{href:"javascript:;"},on:{click:t.saveAvatar}},[t._v("裁剪")]),t._v(" "),s("a",{staticClass:"clip-btn",attrs:{href:"javascript:;"},on:{click:t.confirm}},[t._v("确定")])])])},staticRenderFns:[]};var o={name:"userInfo",components:{avatarImage:s("Z0/y")(n,r,!1,function(t){s("4IDF")},"data-v-7db008a4",null).exports},data:function(){return{userInfo:null,isAvailabelBtn:!0,countTime:60,currentSubNav:null,modifyInfo:{customerId:null,password:null,verifyCode:null},dialogVisible:!1,subNavList:[{value:"basic",label:"基本信息"},{value:"modifyPassword",label:"修改密码"}],modifyRules:{password:[{validator:function(t,e,s){if(!e)return s(new Error("请输入新密码"));!function(t,e,s){e?/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/.test(e)?s():s(new Error("密码必须是6-16位数字+字母组合")):s(new Error("请输入密码"))}(0,e,s)},trigger:"blur"}],verifyCode:[{validator:function(t,e,s){if(!e)return s(new Error("请输入验证码"));s()},trigger:"blur"}]}}},computed:{avatar:function(){return this.$store.state.avatar}},watch:{$route:function(){this.setSubNav()},avatar:function(){var t=this;this.avatar&&(this.dialogVisible=!1,this.axios.post(this.api.modifyAvatar,this.avatar).then(function(e){if(200===e.status&&e.data.code<300){t.userInfo.profilePhoto=e.data.result.imagePath;var s=JSON.parse(sessionStorage.getItem("personalInfo"));s.profilePhoto=e.data.result.imagePath,sessionStorage.setItem("personalInfo",i()(s)),t.$message({message:"设置成功",type:"success"})}else t.$message({message:e.data.remark,type:"error"})}))}},created:function(){this.setSubNav(),this.getUserInfo()},methods:{getUserInfo:function(){var t=this,e=sessionStorage.getItem("personalInfo");if(e)return this.userInfo=JSON.parse(e);this.axios.get(this.api.getUserInfo).then(function(e){200===e.status&&200===e.data.code&&(t.userInfo=e.data.result,sessionStorage.setItem("personalInfo",i()(e.data.result)))})},setSubNav:function(){var t=this;this.currentSubNav=this.subNavList.find(function(e){return e.value===t.$route.query.subNav})},selectSubNav:function(t){this.$router.push({name:"User",query:{nav:this.$route.query.nav,subNav:t.value}})},sendModifyCode:function(t){var e=this,s={mobile:this.userInfo.mobile,smsType:"CHANGE_PWD"};this.axios.post(this.api.getCode,s).then(function(t){if(200===t.status&&200===t.data.code){e.isAvailabelBtn=!1;var s=setInterval(function(){e.countTime--,0===e.countTime&&(clearTimeout(s),e.countTime=60,e.isAvailabelBtn=!0)},1e3)}200===t.status&&"500"===t.data.code&&e.$message.error(t.data.remark)})},inputNewName:function(){var t=this;this.$prompt("新昵称","修改昵称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\S/,inputErrorMessage:"新昵称不能为空"}).then(function(e){var s=e.value;t.modifyNickName(s)})},modifyNickName:function(t){var e=this,s={userName:t};this.axios.post(this.api.modifyNickName,s).then(function(s){200===s.status&&200===s.data.code?(e.$message({message:"修改成功",type:"success"}),e.userInfo.userName=t,sessionStorage.setItem("personalInfo",i()(e.userInfo)),sessionStorage.setItem("userInfo",i()(e.userInfo)),e.$store.dispatch("setUpdateName",!0)):e.$message({message:s.data.remark,type:"error"})})},confirm:function(){var t=this;this.$refs.modifyForm.validate(function(e){e&&(t.modifyInfo.costomerId=t.userInfo.costomerId,t.axios.post(t.api.modifyPassword,t.modifyInfo).then(function(e){200===e.status&&200===e.data.code?(t.$router.push({name:"User",query:{nav:"userInfo",subNav:"basic"}}),t.modifyInfo={customerId:null,password:null,verifyCode:null},t.$message({message:"密码修改成功",type:"success"})):t.$message({message:e.data.remark,type:"error"})}))})}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.currentSubNav?a("div",{attrs:{id:"user-info-wrapper"}},[a("ul",{staticClass:"subnav"},t._l(t.subNavList,function(e,s){return a("li",{class:t.currentSubNav.value===e.value?"active":"",on:{click:function(s){t.selectSubNav(e)}}},[t._v("\n      "+t._s(e.label)+"\n    ")])})),t._v(" "),a("div",{staticClass:"content-wrapper"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"basic"===t.currentSubNav.value,expression:"currentSubNav.value === 'basic'"}],staticClass:"content"},[t.userInfo&&t.userInfo.profilePhoto?a("img",{staticClass:"profile-photo",attrs:{src:t.userInfo.profilePhoto+t.imageMiddleWidth},on:{click:function(e){t.dialogVisible=!0}}}):a("img",{staticClass:"profile-photo",attrs:{src:s("Irh6")},on:{click:function(e){t.dialogVisible=!0}}}),t._v(" "),a("div",{staticClass:"user-info"},[a("div",[a("span",{staticClass:"label"},[t._v("昵称：")]),t._v(" "),t.userInfo?a("span",{staticClass:"value"},[t._v(t._s(t.userInfo.userName||t.userInfo.mobile))]):t._e(),t._v(" "),a("i",{staticClass:"iconfont icon-bianji",on:{click:t.inputNewName}})]),t._v(" "),a("div",[a("span",{staticClass:"label"},[t._v("手机：")]),t._v(" "),t.userInfo?a("span",{staticClass:"value"},[t._v(t._s(t.userInfo.mobile))]):t._e()]),t._v(" "),a("div",[a("span",{staticClass:"label"},[t._v("密码：")]),t._v(" "),a("a",{staticClass:"link",attrs:{href:"javascript:;"},on:{click:function(e){t.$router.push({name:"User",query:{nav:t.$route.query.nav,subNav:"modifyPassword"}})}}},[t._v("\n            修改密码\n          ")])])])]),t._v(" "),"modifyPassword"===t.currentSubNav.value?a("div",{staticClass:"modify-password"},[a("el-form",{ref:"modifyForm",attrs:{model:t.modifyInfo,"label-width":"100px",rules:t.modifyRules}},[a("el-form-item",{attrs:{label:"新密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入新密码"},model:{value:t.modifyInfo.password,callback:function(e){t.$set(t.modifyInfo,"password",e)},expression:"modifyInfo.password"}})],1),t._v(" "),a("el-form-item",{staticClass:"input-wrapper verification-code",attrs:{label:"验证码",prop:"verifyCode"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入验证码"},model:{value:t.modifyInfo.verifyCode,callback:function(e){t.$set(t.modifyInfo,"verifyCode",e)},expression:"modifyInfo.verifyCode"}}),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isAvailabelBtn,expression:"isAvailabelBtn"}],on:{click:t.sendModifyCode}},[t._v("发送验证码")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.isAvailabelBtn,expression:"!isAvailabelBtn"}],staticClass:"disabled-button",attrs:{disabled:""}},[t._v(t._s(t.countTime)+" 秒后重发")])],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:t.confirm}},[t._v("确定")])],1)],1)],1):t._e()]),t._v(" "),a("el-dialog",{attrs:{title:"上传头像，调整选择框大小进行缩放",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("avatar-image")],1)],1):t._e()},staticRenderFns:[]};var l=s("Z0/y")(o,c,!1,function(t){s("tCxk")},null,null).exports,d={replace:!0,data:function(){return{tipShow:!0,msTime:{show:!1,day:"",hour:"",minutes:"",seconds:""},star:"",end:"",current:""}},watch:{currentTime:function(t,e){this.gogogo()}},props:{tipText:{type:String,default:"距离开始"},tipTextEnd:{type:String,default:"距离结束"},id:{type:String,default:"1"},currentTime:{type:Number},startTime:{type:Number},endTime:{type:Number},endText:{type:String,default:"已结束"},dayTxt:{type:String,default:":"},hourTxt:{type:String,default:":"},minutesTxt:{type:String,default:":"},secondsTxt:{type:String,default:":"},secondsFixed:{type:Boolean,default:!1}},mounted:function(){this.gogogo()},methods:{gogogo:function(){var t=this;10===this.startTime.toString().length?this.star=1e3*this.startTime:this.star=this.startTime,10===this.endTime.toString().length?this.end=1e3*this.endTime:this.end=this.endTime,this.currentTime?10===this.currentTime.toString().length?this.current=1e3*this.currentTime:this.current=this.currentTime:this.current=(new Date).getTime(),this.end<this.current?(this.msTime.show=!1,this.end_message()):this.current<this.star?(this.$set(this,"tipShow",!0),setTimeout(function(){t.runTime(t.star,t.current,t.start_message)},1)):(this.end>this.current&&this.star<this.current||this.star==this.current)&&(this.$set(this,"tipShow",!1),this.msTime.show=!0,this.$emit("start_callback",this.msTime.show),setTimeout(function(){t.runTime(t.end,t.star,t.end_message,!0)},1))},runTime:function(t,e,s,a){var i=this,n=this.msTime,r=t-e;if(r>0){this.msTime.show=!0,n.day=Math.floor(r/864e5),r-=864e5*n.day,n.hour=Math.floor(r/36e5),r-=36e5*n.hour,n.minutes=Math.floor(r/6e4),r-=6e4*n.minutes,n.seconds=Math.floor(r/1e3).toFixed(0),r-=1e3*n.seconds,n.hour<10&&(n.hour="0"+n.hour),n.minutes<10&&(n.minutes="0"+n.minutes),n.seconds<10&&(n.seconds="0"+n.seconds);var o=Date.now(),c=Date.now();setTimeout(function(){a?i.runTime(i.end,e+=1e3,s,!0):i.runTime(i.star,e+=1e3,s)},1e3-(c-o))}else s()},start_message:function(){var t=this;this.$set(this,"tipShow",!1),this.$emit("start_callback",this.msTime.show),setTimeout(function(){t.runTime(t.end,t.star,t.end_message,!0)},1)},end_message:function(){this.msTime.show=!1,this.currentTime<=0||this.$emit("end_callback",this.msTime.show)}}},u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.msTime.show?s("p",[t.msTime.day>0?s("span",[s("span",[t._v(t._s(t.msTime.day))]),s("i",[t._v(t._s(t.dayTxt))])]):t._e(),t._v(" "),s("span",[t._v(t._s(t.msTime.hour))]),s("i",[t._v(t._s(t.hourTxt))]),t._v(" "),s("span",[t._v(t._s(t.msTime.minutes))]),s("i",[t._v(t._s(t.minutesTxt))]),t._v(" "),s("span",[t._v(t._s(t.msTime.seconds))]),s("i",[t._v(t._s(t.secondsTxt))])]):t._e()])},staticRenderFns:[]},h=s("Z0/y")(d,u,!1,null,null,null).exports;function v(t){return t>9?t:"0"+t}Date.prototype.toLocaleString=function(){return this.getFullYear()+"-"+v(this.getMonth()+1)+"-"+v(this.getDate())+" "+v(this.getHours())+":"+v(this.getMinutes())};var m={components:{countDown:h},data:function(){return{currentSubNav:null,orderDetail:null,isDetail:!1,orderInfo:null,currentNavList:[],currentPageIdentify:"ORDER_LIST",currentPage:1,pageSize:10,orderAmount:null,time:0,options:[{value:0,label:"三个月内的订单"},{value:4,label:"半年内的订单"},{value:1,label:"今年的订单"},{value:2,label:"去年的订单"},{value:3,label:"前年的订单"}],currentTime:(new Date).getTime(),subNavList:[{value:"all",label:"全部订单"},{value:"toPay",label:"待付款"},{value:"transporting",label:"配送中"},{value:"toBePicked",label:"待自提"}],orderNavList:[{value:"orderDetail",label:"订单详情"}]}},computed:{countNumber:function(){var t=0;return this.orderDetail.orderCommList.forEach(function(e){return t+=e.count}),t}},watch:{$route:function(){this.init()}},created:function(){this.init()},methods:{toPay:function(t){sessionStorage.setItem("lastPayPrice",t.orderAmount),this.$router.push({name:"Pay",params:{orderNum:t.orderNo,payType:0}})},init:function(){"orderDetail"===this.$route.query.subNav?(this.isDetail=!0,this.currentPageIdentify="ORDER_DETAIL",this.currentNavList=this.orderNavList,this.getOrderDetail()):(this.isDetail=!1,this.currentPageIdentify="ORDER_LIST",this.currentNavList=this.subNavList,this.getOrderAmount(),this.getOrderInfo()),this.setSubNav()},getOrderAmount:function(){var t=this;this.axios.get(this.api.getOrderAmount).then(function(e){200===e.status&&200===e.data.code&&(t.orderAmount=e.data.result)})},getOrderNum:function(t){switch(t){case"all":return this.orderAmount.ALL;case"toPay":return this.orderAmount.UNPAIED;case"transporting":return this.orderAmount.PACKAGED;case"toBePicked":return this.orderAmount.WAIT_DISPATCHING;case"toBeEvaluated":return this.orderAmount.UN_COMMENT}},getOrderInfoByTime:function(){this.currentPage=1,this.getOrderInfo()},getOrderInfo:function(){var t=this,e={status:null,start:(this.currentPage-1)*this.pageSize,limit:this.pageSize,time:this.time};switch(this.$route.query.subNav){case"all":e.status=-1;break;case"toPay":e.status=1;break;case"transporting":e.status=4;break;case"toBePicked":e.status=5;break;case"toBeEvaluated":e.status=6}this.axios.get(this.api.getOrderInfo+"?status="+e.status+"&start="+e.start+"&limit="+e.limit+"&hours="+e.time).then(function(e){200===e.status&&200===e.data.code&&(e.data.result.results.forEach(function(e){e.orderCommList.sort(t.compare)}),t.orderInfo=e.data.result)})},compare:function(t,e){return t.isFree<e.isFree?-1:1},setSubNav:function(){var t=this;this.currentSubNav=this.currentNavList.find(function(e){return e.value===t.$route.query.subNav})},selectSubNav:function(t){this.currentPage=1,this.$router.push({name:"User",query:{nav:this.$route.query.nav,subNav:t.value}})},getTime:function(t){return(t=new Date(t)).toLocaleString()},countDownS_cb:function(t){},countDownE_cb:function(t){this.cancelOrder(t)},getStatus:function(t){switch(t){case-1:return"全部";case 0:return"已取消";case 1:return"待付款";case 2:return"已付款";case 3:return"待发货";case 4:return"配送中";case 5:return"待自提";case 6:return"待评价";case 7:return"待自提";case 8:return"已完成"}},getStepActive:function(t){switch(t){case-1:return 0;case 0:return 1;case 1:return 0;case 2:case 3:return 1;case 4:return 2;case 5:return 3;case 6:return 4;case 7:return 3;case 8:return 4}},getTransStatus:function(t){switch(t){case 0:return"自提点自提";case 1:return"送货到家"}},addCart:function(t){var e=this,s={commodityCode:t.code,num:1,secKill:!1};this.axios.post(this.api.save,s).then(function(t){200===t.status&&200===t.data.code?(e.$message({message:"加入购物车成功",type:"warning"}),e.$store.dispatch("getCartNum")):e.$message({message:t.data.remark,type:"warning"})})},addCartBatch:function(){var t=this,e=[];this.orderDetail.orderCommList.forEach(function(t){0===t.isFree&&e.push({commodityCode:t.code,num:t.count,secKill:!1})}),this.axios.post(this.api.batchSave,e).then(function(e){200===e.status&&e.data.code<300?t.$store.dispatch("getCartNum"):t.$message({message:e.data.remark,type:"warning"})})},buyAgain:function(){var t=[];this.orderDetail.orderCommList.forEach(function(e){0===e.isFree&&t.push({commodityCode:e.code,num:e.count,secKill:!1})}),sessionStorage.setItem("toPayCommodityList",i()(t)),this.$router.push({name:"prePay"})},handleCurrentChange:function(t){this.currentPage=t,window.scrollTo(0,0),this.getOrderInfo()},viewOrder:function(t){this.$router.push({name:"User",query:{nav:this.$route.query.nav,subNav:"orderDetail",orderNo:t.orderNo}})},cancelOrder:function(t){var e=this;this.$confirm("是否取消订单？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s=2===t.isParent?t.orderNo:t.orderNoParent;e.axios.get(e.api.cancelOrder+"?orderNo="+s).then(function(s){200===s.status&&s.data.code<300?(e.$message({message:"取消订单成功",type:"success"}),t.status=0,e.orderInfo.results.forEach(function(e){2!==t.isParent&&e.orderNoParent===t.orderNoParent&&(e.status=0)}),e.getOrderInfo()):e.$message({message:s.data.remark,type:"error"})})})},getOrderDetail:function(){var t=this;this.axios.get(this.api.getOrderDetail+"?orderNo="+this.$route.query.orderNo).then(function(e){200===e.status&&200===e.data.code?(e.data.result.orderCommList.sort(t.compare),t.orderDetail=e.data.result):t.$message({message:e.data.remark,type:"warning"})})}}},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.currentSubNav?s("div",{attrs:{id:"order"}},[s("div",["ORDER_LIST"===t.currentPageIdentify?s("ul",{staticClass:"subnav"},t._l(t.subNavList,function(e,a){return s("li",{class:t.currentSubNav.value===e.value?"active":"",on:{click:function(s){t.selectSubNav(e)}}},[t._v("\n        "+t._s(e.label)+"\n        "),t.orderAmount&&t.getOrderNum(e.value)>0?s("span",[t._v("("+t._s(t.getOrderNum(e.value))+")")]):t._e()])})):s("ul",{staticClass:"subnav"},t._l(t.orderNavList,function(e,a){return s("li",{class:t.currentSubNav.value===e.value?"active":"",on:{click:function(s){t.selectSubNav(e)}}},[t._v("\n        "+t._s(e.label)+"\n      ")])})),t._v(" "),s("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){t.getOrderInfoByTime()}},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}},t._l(t.options,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),!t.isDetail&&t.orderInfo?s("div",{staticClass:"content-wrapper"},[t._l(t.orderInfo.results,function(e,a){return s("div",{key:a,staticClass:"order-wrapper"},[s("div",{staticClass:"order-info"},[s("span",{staticClass:"create-time"},[t._v(t._s(t.getTime(e.createTime)))]),t._v(" "),s("span",{staticClass:"order-no"},[t._v("订单号："+t._s(e.orderNo))]),t._v(" "),s("span",{staticClass:"customer"},[t._v("收货人："+t._s(e.receiver))]),t._v(" "),s("span",{staticClass:"order-status"},[t._v("\n            订单状态："),s("span",[t._v(t._s(t.getStatus(e.status)))])]),t._v(" "),1===e.status?[s("count-down",{staticClass:"count-down",attrs:{startTime:t.currentTime,endTime:e.createTime+18e5,tipText:"",tipTextEnd:"",endText:"",dayTxt:"天",hourTxt:" :",minutesTxt:" :",secondsTxt:""},on:{start_callback:function(s){t.countDownS_cb(e)},end_callback:function(s){t.countDownE_cb(e)}}}),t._v(" "),s("a",{staticClass:"cancel-order",attrs:{href:"javascript:;"},on:{click:function(s){t.cancelOrder(e)}}},[t._v("取消订单")])]:t._e(),t._v(" "),s("a",{staticClass:"view-order",attrs:{href:"javascript:;"},on:{click:function(s){t.viewOrder(e)}}},[t._v("查看订单")]),t._v(" "),1===e.status?s("button",{staticClass:"to-pay",on:{click:function(s){t.$router.push({name:"Pay",params:{orderNum:e.orderNoParent||e.orderNo,payType:0}})}}},[t._v("\n            马上支付\n          ")]):t._e()],2),t._v(" "),t._l(e.orderCommList,function(e,a){return s("div",{key:a,staticClass:"order"},[s("img",{attrs:{src:e.pictureUrl+t.imageMiddleWidth},on:{click:function(s){t.$router.push({name:"Detail",params:{commodityCode:e.code}})}}}),t._v(" "),s("span",{staticClass:"order-name",on:{click:function(s){t.$router.push({name:"Detail",params:{commodityCode:e.code}})}}},[e.isFree?s("span",[t._v("【赠品】")]):t._e(),t._v("\n            "+t._s(e.name)+"\n          ")]),t._v(" "),s("span",{staticClass:"order-count"},[t._v("共"+t._s(e.count)+"件")]),t._v(" "),s("span",{staticClass:"order-total"},[t._v("¥ "+t._s(e.price.toFixed(2)))]),t._v(" "),s("span",{staticClass:"order-status"},[t._v(t._s(t.getStatus(e.status)))]),t._v(" "),s("a",{staticClass:"operation",attrs:{href:"javascript:;"},on:{click:function(s){t.addCart(e)}}},[t._v("重新加入购物车")])])})],2)}),t._v(" "),s("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:"total, prev, pager, next",total:t.orderInfo.total},on:{"current-change":t.handleCurrentChange}})],2):t.orderDetail?s("div",{staticClass:"order-info-wrapper"},[s("div",{staticClass:"order-wrapper"},[s("div",{staticClass:"order-info"},[s("span",{staticClass:"order-status"},[t._v("\n            订单状态："),s("span",[t._v(t._s(t.getStatus(t.orderDetail.status)))])]),t._v(" "),s("span",{staticClass:"order-no"},[t._v("订单号："+t._s(t.orderDetail.orderNo))]),t._v(" "),t.orderDetail.verification&&0!==t.orderDetail.status&&1!==t.orderDetail.status?s("span",{staticClass:"order-verification"},[t._v("\n            提货码：\n            "),s("span",[t._v(t._s(t.orderDetail.verification))])]):t._e()]),t._v(" "),s("div",[s("span",{staticClass:"receiver"},[t._v("收货人："+t._s(t.orderDetail.receiver))]),t._v(" "),s("span",{staticClass:"mobile"},[t._v("手机号："+t._s(t.orderDetail.phone))]),t._v(" "),s("span",{staticClass:"address"},[t._v("家庭住址："+t._s(t.orderDetail.addr))])]),t._v(" "),s("div",{staticClass:"trans-wrapper"},[s("span",{staticClass:"trans-type"},[t._v("配送方式："+t._s(t.getTransStatus(t.orderDetail.sendType)))]),t._v(" "),s("span",{staticClass:"deliver-time"},[t._v("指定到达时间："+t._s(t.getTime(t.orderDetail.deliverTime)))]),t._v(" "),s("span",{staticClass:"site"},[t._v("自提点："+t._s(t.orderDetail.site))])])]),t._v(" "),s("div",{staticClass:"commodity-list"},[s("div",{staticClass:"commodity-title"},[t._v("商品信息")]),t._v(" "),0!==t.orderDetail.status?s("el-steps",{attrs:{active:t.getStepActive(t.orderDetail.status),"align-center":""}},[s("el-step",{attrs:{title:"成功提交订单"}}),t._v(" "),s("el-step",{attrs:{title:"付款成功"}}),t._v(" "),s("el-step",{attrs:{title:"配送中"}}),t._v(" "),s("el-step",{attrs:{title:"待自提"}}),t._v(" "),s("el-step",{attrs:{title:"完成"}})],1):s("el-steps",{attrs:{active:t.getStepActive(t.orderDetail.status),"align-center":""}},[s("el-step",{attrs:{title:"成功提交订单"}}),t._v(" "),s("el-step",{attrs:{title:"已取消"}})],1),t._v(" "),s("el-table",{attrs:{data:t.orderDetail.orderLogList,stripe:""}},[s("el-table-column",{attrs:{prop:"oprTime",label:"处理时间",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(t.getTime(e.row.oprTime))+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"oprContent",label:"订单处理",width:"500"}}),t._v(" "),s("el-table-column",{attrs:{prop:"oprator",label:"操作人",width:"200"}})],1),t._v(" "),s("div",{attrs:{clsss:"commodity-wrapper"}},[t._m(0),t._v(" "),t._l(t.orderDetail.orderCommList,function(e,a){return s("div",{key:a,staticClass:"commodity-content"},[s("span",{staticClass:"commodity-code"},[t._v(t._s(e.code))]),t._v(" "),s("img",{staticClass:"commodity-image",attrs:{src:e.pictureUrl+t.imageMiddleWidth},on:{click:function(s){t.$router.push({name:"Detail",params:{commodityCode:e.code}})}}}),t._v(" "),s("span",{staticClass:"commodity-name"},[e.isFree?s("span",[t._v("【赠品】")]):t._e(),t._v("\n              "+t._s(e.name)+"\n            ")]),t._v(" "),0===e.isFree?[s("span",{staticClass:"commodity-price"},[t._v("\n                ¥ "+t._s(e.actPrice.toFixed(2))+"\n              ")]),t._v(" "),s("span",{staticClass:"commodity-number"},[t._v(t._s(e.count))]),t._v(" "),s("span",{staticClass:"total-amount"},[t._v("¥ "+t._s((e.price*e.count).toFixed(2)))])]:t._e(),t._v(" "),1===e.isFree?[s("span",{staticClass:"commodity-price"},[t._v("\n              ¥ "+t._s(e.price.toFixed(2))+"\n            ")]),t._v(" "),s("span",{staticClass:"commodity-number"},[t._v(t._s(e.count))]),t._v(" "),s("span",{staticClass:"total-amount"},[t._v("¥ "+t._s(e.subTotal.toFixed(2)))])]:t._e()],2)})],2),t._v(" "),s("div",{staticClass:"pay-wrapper"},[s("div",[s("span",{staticClass:"label"},[t._v("共"+t._s(t.countNumber)+"件商品，订单总金额：")]),t._v(" "),t.orderDetail.orderIntegral?s("span",{staticClass:"value"},[t._v(t._s(t.orderDetail.orderIntegral)+"积分")]):s("span",{staticClass:"value"},[t._v("¥ "+t._s(t.orderDetail.comAmount.toFixed(2)))])]),t._v(" "),t.orderDetail.fullDiscount?s("div",[s("span",{staticClass:"label"},[t._v("满减折扣：")]),t._v(" "),s("span",{staticClass:"value"},[t._v("¥ "+t._s((t.orderDetail.fullDiscount||0).toFixed(2)))])]):t._e(),t._v(" "),t.orderDetail.sellDiscount?s("div",[s("span",{staticClass:"label"},[t._v("买赠折扣：")]),t._v(" "),s("span",{staticClass:"value"},[t._v("¥ "+t._s((t.orderDetail.sellDiscount||0).toFixed(2)))])]):t._e(),t._v(" "),t.orderDetail.ylcardDiscount?s("div",[s("span",{staticClass:"label"},[t._v("银犁卡折扣：")]),t._v(" "),s("span",{staticClass:"value"},[t._v("¥ "+t._s((t.orderDetail.ylcardDiscount||0).toFixed(2)))])]):t._e(),t._v(" "),t.orderDetail.voucherDiscount?s("div",[s("span",{staticClass:"label"},[t._v("优惠券折扣：")]),t._v(" "),s("span",{staticClass:"value"},[t._v("¥ "+t._s((t.orderDetail.voucherDiscount||0).toFixed(2)))])]):t._e(),t._v(" "),t.orderDetail.discount?s("div",[s("span",{staticClass:"label"},[t._v("优惠折扣：")]),t._v(" "),s("span",{staticClass:"value"},[t._v("¥ "+t._s((t.orderDetail.discount||0).toFixed(2)))])]):t._e(),t._v(" "),s("div",[s("span",{staticClass:"label"},[t._v("实付金额：")]),t._v(" "),s("span",{staticClass:"value"},[t._v("¥ "+t._s((t.orderDetail.orderAmount||0).toFixed(2)))])]),t._v(" "),s("div",[1===t.orderDetail.status?s("button",{staticClass:"to-pay",on:{click:function(e){t.toPay(t.orderDetail)}}},[t._v("\n            马上支付\n          ")]):0===t.orderDetail.status?s("button",{staticClass:"to-pay",on:{click:t.addCartBatch}},[t._v("\n            重新加入购物车\n          ")]):s("button",{staticClass:"to-pay",on:{click:t.buyAgain}},[t._v("\n            再次购买\n          ")])])])],1)]):t._e()],1)]):t._e()},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"commodity-header"},[s("span",{staticClass:"commodity-code"},[t._v("商品编号")]),t._v(" "),s("span",{staticClass:"commodity-image"}),t._v(" "),s("span",{staticClass:"commodity-name"},[t._v("商品名称")]),t._v(" "),s("span",{staticClass:"commodity-price"},[t._v("单价")]),t._v(" "),s("span",{staticClass:"commodity-number"},[t._v("数量")]),t._v(" "),s("span",{staticClass:"total-amount"},[t._v("金额")])])}]};var p=s("Z0/y")(m,f,!1,function(t){s("Cfaj")},null,null).exports,g={name:"addressSet",components:{addressMapSet:s("Cos7").a},data:function(){return{addressList:[],customerId:sessionStorage.getItem("userInfo")&&JSON.parse(sessionStorage.getItem("userInfo")).customerId}},watch:{},mounted:function(){this.$store.dispatch("setAddressTypeStatus",!1)},computed:{isShowForm:function(){return this.$store.state.isShowForm}},created:function(){this.getAddressList()},methods:{reloadgetAddressList:function(t){this.getAddressList()},addressEditFather:function(t){this.$refs.mapRef.addressEdit(t)},delAddress:function(t){var e=this;confirm("确定要删除当前地址?")&&this.axios.get(this.api.deleteAddress+"?customerId="+this.customerId+"&id="+t.id).then(function(t){200===t.status&&200===t.data.code&&(e.$message.success("删除成功!"),e.getAddressList(),e.$store.dispatch("setAddressTypeStatus",!1))})},getAddressList:function(){var t=this;this.axios.get(this.api.getAddressList+"?customerId="+this.customerId).then(function(e){200===e.status&&200===e.data.code&&(t.addressList=e.data.result||[])})},selectDefaultAddress:function(t){var e=this;if(t.isDefault)return!1;this.axios.get(this.api.setDefaultAddress+"?customerId="+this.customerId+"&id="+t.id).then(function(t){200===t.status&&200===t.data.code&&(e.$message.success("默认地址设置成功!"),e.getAddressList())})}}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"1038px"},attrs:{id:"user-info-wrapper"}},[s("ul",{staticClass:"subnav"},[s("li",[s("i",[t._v("已经保存的收货地址("+t._s(t.addressList&&t.addressList.length||0)+")")]),t._v(" "),s("i",{staticClass:"c-green",on:{click:function(e){t.addressEditFather({county:0})}}},[t._v("新增收货地址")])])]),t._v(" "),s("div",{staticClass:"address-list-box f12"},t._l(t.addressList,function(e,a){return s("div",[s("ul",[s("li",{staticClass:"li-header",class:{isDefault:e.isDefault,"c-green":e.isDefault}},[s("span",[t._v(t._s(e.contactName))]),s("i",{class:{cursor:!e.isDefault},on:{click:function(s){t.selectDefaultAddress(e)}}},[t._v(t._s(e.isDefault?"默认":"设为默认"))])]),t._v(" "),s("li",[t._v(t._s(e.address)),s("span",{staticClass:"block"},[t._v("自提点 : "+t._s(e.addressAlias))])]),t._v(" "),s("li",{staticClass:"li-footer"},[s("span",[t._v(t._s(e.mobile))]),s("span",[s("i",{staticClass:"c-green cursor mr10",on:{click:function(s){t.addressEditFather(e)}}},[t._v("修改")]),s("i",{staticClass:"cursor",on:{click:function(s){t.delAddress(e)}}},[t._v("删除")])])])])])})),t._v(" "),s("addressMapSet",{ref:"mapRef",on:{getAddressListRs:function(e){t.reloadgetAddressList()}}})],1)},staticRenderFns:[]};var C={name:"Collection",data:function(){return{pageSize:9,currentPage:1,collectionList:[],selectedList:[],collectionInfo:null,isSelectAll:!1,subNavList:[{value:"collectionList",label:"关注列表"}]}},watch:{collectionList:{handler:function(t,e){this.selectedList=this.collectionList.filter(function(t){return t.checked})||[],this.isSelectAll=this.collectionList.every(function(t){return!0===t.checked})},deep:!0}},created:function(){this.getCollectionList()},methods:{getCollectionList:function(){var t=this;this.axios.get(this.api.getCollectionList+"?pageNum="+this.currentPage+"&pageSize="+this.pageSize).then(function(e){200===e.status&&200===e.data.code?(e.data.result.results&&e.data.result.results.forEach(function(t){t.checked=!1}),t.collectionInfo=e.data.result,t.collectionList=e.data.result.results||[]):t.$message({message:e.data.remark,type:"warning"})})},selectAll:function(t){this.collectionList.forEach(function(e){return e.checked=t})},addCartBatch:function(){var t=this;if(0===this.selectedList.length)return this.$message({message:"未选中商品",type:"warning"});var e=[];this.selectedList.forEach(function(t){e.push({commodityCode:t.commodityCode,num:1,secKill:!1})}),this.axios.post(this.api.batchSave,e).then(function(e){200===e.status&&e.data.code<300?(t.selectedList.forEach(function(t){return t.checked=!1}),t.$store.dispatch("getCartNum"),t.$message({message:"加入购物车成功",type:"success"})):t.$message({message:e.data.remark,type:"warning"})})},cancelCollected:function(){var t=this;if(0===this.selectedList.length)return this.$message({message:"未选中商品",type:"warning"});this.$confirm("是否取消关注？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=[];t.selectedList.forEach(function(t){return e.push(t.id)}),t.axios.post(t.api.removeBatchCollection,e).then(function(e){200===e.status&&e.data.code<300&&t.getCollectionList()})}).catch(function(t){})},clearCollected:function(){var t=this;if(0===this.collectionList.length)return this.$message({message:"没有收藏的商品",type:"warning"});this.$confirm("是否清空关注？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.axios.post(t.api.removeAll).then(function(e){200===e.status&&e.data.code<300&&t.getCollectionList()})}).catch(function(t){})},addCart:function(t){var e=this,s={commodityCode:t.commodityCode,num:1,secKill:!1};this.axios.post(this.api.save,s).then(function(t){200===t.status&&t.data.code<300?(e.$store.dispatch("getCartNum"),e.$message({message:"加入购物车成功",type:"success"})):e.$message({message:t.data.remark,type:"warning"})})},collect:function(t){var e=this;this.$confirm("是否取消收藏？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.axios.get(e.api.removeCollection+"?commodityCode="+t.commodityCode).then(function(t){200===t.status&&t.data.code<300&&e.getCollectionList()})}).catch(function(t){})},handleCurrentChange:function(t){this.currentPage=t,window.scrollTo(0,0),this.getCollectionList()}}},b={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"collection"}},[s("ul",{staticClass:"subnav"},t._l(t.subNavList,function(e,a){return s("li",{staticClass:"active"},[t._v("\r\n      "+t._s(e.label)+"\r\n    ")])})),t._v(" "),s("div"),t._v(" "),s("div",{staticClass:"operation-wrapper"},[s("span",[t._v("批量操作")]),t._v(" "),s("el-checkbox",{on:{change:t.selectAll},model:{value:t.isSelectAll,callback:function(e){t.isSelectAll=e},expression:"isSelectAll"}},[t._v("全选")]),t._v(" "),s("span",{staticClass:"add-cart",on:{click:t.addCartBatch}},[s("i",{staticClass:"iconfont icon-gouwuche"}),t._v("\r\n      加入购物车\r\n    ")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.cancelCollected}},[t._v("取消关注")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.clearCollected}},[t._v("清空关注")])],1),t._v(" "),s("ul",{staticClass:"collection-list"},t._l(t.collectionList,function(e,a){return s("li",{key:a,staticStyle:{position:"relative"}},[3===e.commodityStatus&&0===e.commodityStock?s("span",{staticClass:"icon-no-stock"},[t._v("已售罄"),s("br"),t._v("拼命补货中")]):t._e(),t._v(" "),4===e.commodityStatus?s("span",{staticClass:"icon-no-stock"},[s("i",{staticStyle:{"padding-top":"10px",display:"block"}},[t._v("商品已下架")])]):t._e(),t._v(" "),e.presell?[s("i",{staticClass:"iconfont icon-yushou"}),t._v(" "),s("div",{staticClass:"trangle"})]:t._e(),t._v(" "),s("img",{attrs:{src:e.imageUrl},on:{click:function(s){t.$router.push({name:"Detail",params:{commodityCode:e.commodityCode}})}}}),t._v(" "),s("div",{staticClass:"commodity-name",on:{click:function(s){t.$router.push({name:"Detail",params:{commodityCode:e.commodityCode}})}}},[t._v(t._s(e.commodityName))]),t._v(" "),s("div",{staticClass:"commodity-price"},[t._v("¥ "+t._s(e.commoditySalesPrice.toFixed(2)))]),t._v(" "),s("div",{staticClass:"commodity-operation"},[s("span",{staticClass:"add-cart",on:{click:function(s){t.addCart(e)}}},[s("i",{staticClass:"iconfont icon-gouwuche"}),t._v("\r\n          加入购物车\r\n        ")]),t._v(" "),s("el-checkbox",{model:{value:e.checked,callback:function(s){t.$set(e,"checked",s)},expression:"item.checked"}},[t._v("选择")]),t._v(" "),s("span",{staticClass:"collection active",on:{click:function(s){t.collect(e)}}},[s("i",{staticClass:"iconfont icon-guanzhu-tianchong"}),t._v("\r\n          取消关注\r\n        ")])],1)],2)})),t._v(" "),t.collectionInfo?s("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:"total, prev, pager, next",total:t.collectionInfo.total},on:{"current-change":t.handleCurrentChange}}):t._e()],1)},staticRenderFns:[]};var y={components:{userInfo:l,order:p,addressSet:s("Z0/y")(g,_,!1,function(t){s("1ain")},"data-v-0c5a730a",null).exports,collection:s("Z0/y")(C,b,!1,function(t){s("InW0")},null,null).exports},data:function(){return{currentNav:null,currentSubNav:null,navList:[{value:"userInfo",label:"个人信息",route:null,subNavList:[{value:"basic",label:"基本信息"},{value:"modifyPassword",label:"修改密码"}]},{value:"order",label:"我的订单",route:null,subNavList:[{value:"all",label:"全部订单"},{value:"toPay",label:"待付款"},{value:"transporting",label:"配送中"},{value:"toBePicked",label:"待自提"}]},{value:"cart",label:"购物车",route:"Cart"},{value:"addressSet",label:"收货地址",route:null,subNavList:[{value:"existing",label:"已保存的收货地址"}]},{value:"collection",label:"我的关注",route:null,subNavList:[{value:"collectionList",label:"关注列表"}]}]}},watch:{$route:function(){this.setNav()}},created:function(){this.setNav()},methods:{setNav:function(){var t=this.$route.query;this.currentNav=this.navList.find(function(e){return e.value===t.nav})},selectNav:function(t){this.$store.dispatch("setAddressTypeStatus",!1),t.route||this.$router.push({name:"User",query:{nav:t.value,subNav:t.subNavList[0].value}})}}},w={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"user"}},[s("ul",{staticClass:"nav"},t._l(t.navList,function(e,a){return s("li",{class:t.currentNav===e?"active":"",on:{click:function(s){t.selectNav(e)}}},[e.route?s("span",{on:{click:function(s){t.$router.push({name:e.route})}}},[t._v(t._s(e.label))]):s("span",[t._v(t._s(e.label))])])})),t._v(" "),s("div",{staticClass:"container"},[s("keep-alive",{attrs:{exclude:"order"}},[s(t.currentNav.value,{tag:"component"})],1)],1)])},staticRenderFns:[]};var x=s("Z0/y")(y,w,!1,function(t){s("Nhtd")},null,null);e.default=x.exports},"1ain":function(t,e){},"4IDF":function(t,e){},"6FDK":function(t,e){},Cfaj:function(t,e){},Cos7:function(t,e,s){"use strict";var a=s("aA9S"),i=s.n(a),n=s("4YfN"),r=s.n(n),o=s("C80W"),c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[!1===this.checkResult?e("em",{staticClass:"f12 c-red block pa"},[this._v(this._s(this.checkErrorText))]):this._e()])},staticRenderFns:[]},l=s("Z0/y")({name:"noFile",props:["checkErrorText","checkResult"],data:function(){return{}}},c,!1,null,null,null).exports,d=s("9rMa"),u={name:"addressMapSet",props:["srcs"],components:{noFile:o.a,checkErr:l},data:function(){return{defMap:"",isPass:!0,defPoi:"",isEdit:!1,mapInfo:[],mapDataInfo:[],addressStoreList:[],defaultArea:["四川省","成都市",""],customerId:sessionStorage.getItem("userInfo")&&JSON.parse(sessionStorage.getItem("userInfo")).customerId,isSelect:0,isDefaultCounty:0,isDefaultSite:null,addressInfo:{mobile:"",addressAppend:"",province:"",city:"",county:"",contactName:""},checkAddressInfo:{contactName:{pattern:"realName",status:void 0},mobile:{pattern:"phone",status:void 0}}}},mounted:function(){this.createBaiduMap()},computed:r()({},Object(d.b)(["isShowForm"])),watch:{"addressInfo.county":function(t){this.isDefaultCounty==t?this.addressInfo.site=this.isDefaultSite:this.addressInfo.site=null,this.isDefaultCounty!=t&&(this.isSelect=null),this.getAddressStoreList(t)}},methods:{createBaiduMap:function(){this.defMap=new BMap.Map("allBaiduMap"),this.defPoi=new BMap.Point(116.406605,39.921585),this.defMap.centerAndZoom(this.defPoi,12),this.defMap.centerAndZoom("成都",11),this.defMap.enableScrollWheelZoom(!0)},selectSiteSetMap:function(t){var e=this.defMap,s=this.defaultArea.join("")+t.addr;console.log(s),(new BMap.Geocoder).getPoint(s,function(t){t?e.centerAndZoom(t,15):e.centerAndZoom(this.defaultArea.join(""),15)})},selectSite:function(t){this.isSelect=t.sCode,this.addressInfo.site=t.sCode,this.addressInfo.siteName=t.name,this.addressInfo.addressAlias=t.addr+(t.housing||""),this.selectSiteSetMap(t)},setMapMarker:function(){var t=this.defMap;this.defPoi;t.clearOverlays();for(var e={width:250,height:80,title:"提货地址",enableMessage:!0},s=0;s<this.mapDataInfo.length;s++){var a=new BMap.Marker(new BMap.Point(this.mapDataInfo[s][0],this.mapDataInfo[s][1])),i=this.mapDataInfo[s][2],n=new window.BMap.Label(s+1,{offset:new window.BMap.Size(6,-2)});n.setStyle({color:"white",fontSize:"12px",height:"20px",lineHeight:"23px",fontFamily:"微软雅黑",background:"none",border:"none"}),a.setLabel(n),t.addOverlay(a),r(i,a)}function r(s,a){a.addEventListener("click",function(a){!function(s,a){var i=a.target,n=new BMap.Point(i.getPosition().lng,i.getPosition().lat),r=new BMap.InfoWindow(s,e);t.openInfoWindow(r,n)}(s,a)})}},getAddressStoreList:function(t){var e=this,s=this.mapInfo,a=[];for(var i in s)s[i].code==t&&(this.addressStoreList=s[i].terminalSiteList,this.defaultArea.splice(2,2,s[i].name));this.addressStoreList.forEach(function(t,s){e.addressInfo.site==t.sCode?e.selectSiteSetMap(t):0==s&&e.selectSiteSetMap(t),a.push([t.longitude,t.latitude,t.addr+(t.housing||"")])}),this.mapDataInfo=a,this.setMapMarker()},getAllMapInfo:function(t){var e=this;this.axios.get(this.api.getAllMapInfo).then(function(s){200===s.status&&200===s.data.code&&(e.mapInfo=s.data.result.divisionNodeList[0].secondDivisionList[0].thirdDivisionList,t&&t())})},addressEdit:function(t){var e=this;this.$store.dispatch("setAddressTypeStatus",!0);var s=t;this.isSelect=0,this.isEdit=!!s.id,!s.id&&(this.addressStoreList=[]),this.addressInfo=i()({},s),s.id&&(this.addressInfo.addressAppend=s.address.indexOf("-")>-1&&s.address.substr(s.address.indexOf("-")+1)||""),this.addressInfo.province=51e4,this.addressInfo.city=510100,this.isDefaultCounty=s.county,this.isDefaultSite=s.site,!s.id&&(this.addressInfo.county=510108),!s.id&&(this.addressInfo.isDefault=!0),this.addressInfo.customerId=this.customerId,s.mobile&&this.checkForm(),this.getAllMapInfo(function(){e.getAddressStoreList(e.addressInfo.county)}),this.$nextTick(function(){var t=document.querySelector(".edit-address-map");window.scrollTo(0,t.offsetTop)})},checkForm:function(t){var e=this,s="checkAddressInfo",a=t||null,i=function(t){e[s][t].status=e[s][t].pattern?e.$pub.Regex[e[s][t].pattern].test(e.addressInfo[t]):!!e.addressInfo[t]};if(null==a)for(var n in this[s])""==this[s][n].pattern?this[s][n].status=!!this.addressInfo[n]:i(n),void 0!==this[s][n].status&&!1!==this[s][n].status||(this.isPass=!1);else i(a)},SubmitBtn:function(){var t=this;if(this.isPass=!0,this.checkForm(),!this.isPass)return!1;this.addressInfo.address=this.defaultArea.join(" ")+"-"+(void 0==this.addressInfo.addressAppend?"":this.addressInfo.addressAppend),this.axios.post(this.addressInfo.id?this.api.addressUpdate:this.api.addressAdd,this.addressInfo).then(function(e){200===e.status&&200===e.data.code?(t.$message.success("地址操作成功!"),t.$emit("getAddressListRs",!1),t.$store.dispatch("setAddressTypeStatus",!1)):t.$message.error(e.data.remark)})}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowForm,expression:"isShowForm"}],staticClass:"edit-address-map border-bottom-1px"},[s("div",{staticClass:"box-header b "},[t._v(t._s(t.isEdit?"修改":"新增")+"收货地址")]),t._v(" "),s("div",[s("ul",{staticClass:"base-input",class:{spc:1==t.srcs}},[s("li",{staticClass:"required"},[s("span",[t._v("收货人:")]),s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.addressInfo.contactName,expression:"addressInfo.contactName"}],attrs:{type:"text",maxlength:"20",placeholder:""},domProps:{value:t.addressInfo.contactName},on:{blur:function(e){t.checkForm("contactName")},input:function(e){e.target.composing||t.$set(t.addressInfo,"contactName",e.target.value)}}}),t._v(" "),s("checkErr",{attrs:{checkResult:t.checkAddressInfo.contactName.status,checkErrorText:"收货人为中文,字母,2-20个字符"}})],1)]),t._v(" "),s("li",{staticClass:"required ml20"},[s("span",[t._v("手机号:")]),s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.addressInfo.mobile,expression:"addressInfo.mobile"}],attrs:{type:"tel",maxlength:"11",placeholder:""},domProps:{value:t.addressInfo.mobile},on:{blur:function(e){t.checkForm("mobile")},input:function(e){e.target.composing||t.$set(t.addressInfo,"mobile",e.target.value)}}}),s("checkErr",{attrs:{checkResult:t.checkAddressInfo.mobile.status,checkErrorText:"请输入正确的11位手机号"}})],1)]),t._v(" "),s("li",{staticClass:"required"},[s("span",[t._v("收货地址:")]),t._v(" "),s("p",[s("select",{directives:[{name:"model",rawName:"v-model",value:t.addressInfo.province,expression:"addressInfo.province"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.addressInfo,"province",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"510000"}},[t._v(t._s(t.defaultArea[0]))])]),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.addressInfo.city,expression:"addressInfo.city"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.addressInfo,"city",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"510100"}},[t._v(t._s(t.defaultArea[1]))])]),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.addressInfo.county,expression:"addressInfo.county"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.addressInfo,"county",e.target.multiple?s:s[0])}}},t._l(t.mapInfo,function(e,a){return s("option",{domProps:{value:e.code}},[t._v(" "+t._s(e.name))])})),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.addressInfo.addressAppend,expression:"addressInfo.addressAppend"}],attrs:{type:"tel",maxlength:"30"},domProps:{value:t.addressInfo.addressAppend},on:{input:function(e){e.target.composing||t.$set(t.addressInfo,"addressAppend",e.target.value)}}})])])])]),t._v(" "),s("div",{staticStyle:{padding:"0 0 6px 10px"}},[t._v("自提点")]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.addressStoreList.length>0&&t.isShowForm,expression:"addressStoreList.length>0&&isShowForm"}],staticClass:"map-box"},[s("div",{staticClass:"map-nav"},t._l(t.addressStoreList,function(e,a){return s("div",{staticClass:"list",class:{hover:t.addressInfo.site==e.sCode||t.isSelect==e.sCode},on:{click:function(s){t.selectSite(e)}}},[s("i",[t._v(t._s(a+1))]),t._v(" "),s("span",{staticClass:"f14 b"},[t._v(t._s(e.name))]),t._v(" "),s("p",{staticClass:"f12 pt5"},[t._v(t._s(e.addr)+t._s(e.housing))])])})),t._v(" "),s("div",{attrs:{id:"allBaiduMap"}})]),t._v(" "),s("div",{staticClass:"text-center mb10 mt10"},[s("button",{staticClass:"btn-green c-green",on:{click:function(e){t.SubmitBtn()}}},[t._v("保存地址信息")]),t._v(" "),s("button",{staticClass:"btn-cancel ml20",on:{click:function(e){t.$store.dispatch("setAddressTypeStatus",!1)}}},[t._v("取消")])])])])},staticRenderFns:[]};var v=s("Z0/y")(u,h,!1,function(t){s("6FDK")},"data-v-84d0e21e",null);e.a=v.exports},InW0:function(t,e){},Irh6:function(t,e,s){t.exports=s.p+"static/img/default.9682ad0.png"},Nhtd:function(t,e){},tCxk:function(t,e){}});
//# sourceMappingURL=1.8bb010769b386c1839af.js.map